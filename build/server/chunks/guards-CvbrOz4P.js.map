{"version":3,"file":"guards-CvbrOz4P.js","sources":["../../../.svelte-kit/adapter-node/chunks/guards.js"],"sourcesContent":["import { r as redirect } from \"./index.js\";\nimport { getAuth } from \"firebase-admin/auth\";\nimport { a as adminApp } from \"./firebase-admin.js\";\nasync function requireAuth(event) {\n  try {\n    const auth = getAuth(adminApp);\n    const token = event.cookies.get(\"firebase-token\");\n    if (!token) {\n      throw redirect(303, `/?redirectTo=${event.url.pathname}`);\n    }\n    try {\n      const decodedToken = await auth.verifyIdToken(token);\n      const tokenExp = decodedToken.exp * 1e3;\n      const fiveMinutes = 5 * 60 * 1e3;\n      if (Date.now() + fiveMinutes >= tokenExp) {\n        throw new Error(\"Token about to expire\");\n      }\n      return decodedToken;\n    } catch (tokenError) {\n      event.cookies.delete(\"firebase-token\", { path: \"/\" });\n      throw redirect(303, `/?redirectTo=${event.url.pathname}`);\n    }\n  } catch (error) {\n    console.error(\"Auth error:\", error);\n    throw redirect(303, `/?redirectTo=${event.url.pathname}`);\n  }\n}\nexport {\n  requireAuth as r\n};\n"],"names":[],"mappings":";;;;AAGA,eAAe,WAAW,CAAC,KAAK,EAAE;AAClC,EAAE,IAAI;AACN,IAAI,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC;AAClC,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC;AACrD,IAAI,IAAI,CAAC,KAAK,EAAE;AAChB,MAAM,MAAM,QAAQ,CAAC,GAAG,EAAE,CAAC,aAAa,EAAE,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;AAC/D;AACA,IAAI,IAAI;AACR,MAAM,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC;AAC1D,MAAM,MAAM,QAAQ,GAAG,YAAY,CAAC,GAAG,GAAG,GAAG;AAC7C,MAAM,MAAM,WAAW,GAAG,CAAC,GAAG,EAAE,GAAG,GAAG;AACtC,MAAM,IAAI,IAAI,CAAC,GAAG,EAAE,GAAG,WAAW,IAAI,QAAQ,EAAE;AAChD,QAAQ,MAAM,IAAI,KAAK,CAAC,uBAAuB,CAAC;AAChD;AACA,MAAM,OAAO,YAAY;AACzB,KAAK,CAAC,OAAO,UAAU,EAAE;AACzB,MAAM,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,gBAAgB,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AAC3D,MAAM,MAAM,QAAQ,CAAC,GAAG,EAAE,CAAC,aAAa,EAAE,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;AAC/D;AACA,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,aAAa,EAAE,KAAK,CAAC;AACvC,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,CAAC,aAAa,EAAE,KAAK,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;AAC7D;AACA;;;;"}