{"version":3,"file":"_server.ts-BW5LR4Hz.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/video-transcript/_server.ts.js"],"sourcesContent":["import { e as error } from \"../../../../chunks/index.js\";\nimport axios from \"axios\";\nasync function fetchTranscriptFromYoutube(videoId) {\n  try {\n    const response = await axios.get(`https://youtube.com/watch?v=${videoId}`, {\n      headers: {\n        \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36\",\n        \"Accept-Language\": \"en-US,en;q=0.9\",\n        \"Accept\": \"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\",\n        \"Cache-Control\": \"no-cache\",\n        \"Pragma\": \"no-cache\",\n        \"Referer\": \"https://www.youtube.com/\",\n        \"sec-ch-ua\": '\"Not_A Brand\";v=\"8\", \"Chromium\";v=\"120\"',\n        \"sec-ch-ua-mobile\": \"?0\",\n        \"sec-ch-ua-platform\": '\"Windows\"',\n        \"sec-fetch-dest\": \"document\",\n        \"sec-fetch-mode\": \"navigate\",\n        \"sec-fetch-site\": \"none\",\n        \"sec-fetch-user\": \"?1\"\n      },\n      timeout: 15e3,\n      maxRedirects: 5\n    });\n    const html = response.data;\n    const patterns = [\n      /ytInitialPlayerResponse\\s*=\\s*({.+?});/,\n      /\\\"captions\\\":{\\\"playerCaptionsTracklistRenderer\\\":(.+?)}}/,\n      /\\\"captionTracks\\\":(\\[.+?\\])/\n    ];\n    let playerResponse;\n    let captionTracks;\n    for (const pattern of patterns) {\n      const match = html.match(pattern);\n      if (match) {\n        try {\n          const data = JSON.parse(match[1]);\n          if (data.captions?.playerCaptionsTracklistRenderer?.captionTracks) {\n            captionTracks = data.captions.playerCaptionsTracklistRenderer.captionTracks;\n            break;\n          } else if (Array.isArray(data)) {\n            captionTracks = data;\n            break;\n          }\n        } catch (e) {\n          console.warn(\"Failed to parse match:\", e);\n          continue;\n        }\n      }\n    }\n    if (!captionTracks || captionTracks.length === 0) {\n      throw new Error(\"No captions available\");\n    }\n    const captionTrack = captionTracks.find(\n      (track) => track.languageCode === \"en\" && !track.kind || track.languageCode === \"en\" && track.kind === \"asr\" || track.vssId?.includes(\"en\")\n    );\n    if (!captionTrack?.baseUrl) {\n      throw new Error(\"No English captions found\");\n    }\n    const transcriptResponse = await axios.get(captionTrack.baseUrl, {\n      timeout: 1e4,\n      maxRedirects: 5\n    });\n    return transcriptResponse.data;\n  } catch (error2) {\n    console.error(\"Error fetching transcript:\", error2);\n    throw error2;\n  }\n}\nasync function parseTranscriptXml(transcriptXml) {\n  try {\n    if (transcriptXml.includes(\"<?xml\")) {\n      const match = transcriptXml.match(/<transcript>(.*?)<\\/transcript>/s);\n      if (match && match[1]) {\n        transcriptXml = match[1];\n      }\n    }\n    return transcriptXml.replace(/<text[^>]*>/g, \"\").replace(/<\\/text>/g, \" \").replace(/start=\"[^\"]*\"/g, \"\").replace(/dur=\"[^\"]*\"/g, \"\").replace(/\\s+/g, \" \").replace(/&amp;/g, \"&\").replace(/&quot;/g, '\"').replace(/&#39;/g, \"'\").replace(/&lt;/g, \"<\").replace(/&gt;/g, \">\").trim();\n  } catch (error2) {\n    console.error(\"Error parsing transcript:\", error2);\n    return \"No transcript available for this video\";\n  }\n}\nasync function GET({ url }) {\n  try {\n    const videoId = url.searchParams.get(\"videoId\");\n    if (!videoId) {\n      throw error(400, \"Video ID is required\");\n    }\n    console.log(\"Fetching transcript for video:\", videoId);\n    const transcriptResponse = await fetchTranscriptFromYoutube(videoId);\n    const cleanTranscript = await parseTranscriptXml(transcriptResponse);\n    return new Response(JSON.stringify({ transcript: cleanTranscript }), {\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n  } catch (err) {\n    console.error(\"Error in transcript endpoint:\", err);\n    return new Response(JSON.stringify({\n      transcript: \"No transcript available for this video\",\n      error: err.message\n    }), {\n      status: 200,\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n  }\n}\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}