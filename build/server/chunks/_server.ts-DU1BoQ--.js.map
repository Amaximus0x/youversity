{"version":3,"file":"_server.ts-DU1BoQ--.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/generate-course/_server.ts.js"],"sourcesContent":["import { j as json } from \"../../../../chunks/index.js\";\nimport { d as private_env } from \"../../../../chunks/shared-server.js\";\nimport axios from \"axios\";\nconst POST = async ({ request }) => {\n  try {\n    const { courseInput } = await request.json();\n    if (!courseInput) {\n      return json({\n        success: false,\n        error: \"Course input is required\"\n      }, { status: 400 });\n    }\n    try {\n      const courseStructure = await generateCourse(courseInput);\n      return json({\n        success: true,\n        courseStructure\n      });\n    } catch (error) {\n      console.error(\"Error generating course:\", error);\n      return json({\n        success: false,\n        error: error.message\n      }, { status: 500 });\n    }\n  } catch (error) {\n    console.error(\"Error processing request:\", error);\n    return json({\n      success: false,\n      error: \"Invalid request data\"\n    }, { status: 400 });\n  }\n};\nasync function generateCourse(User_Course_Input) {\n  const prompt = `Build a 10 module course plan based on the input below, with course title and individual module titles. For each module, include one sentence search prompt for youtube to find the best video match for that module. Do not include \"Search Prompt:\" before each search prompt.\n\nHere is the course objective - simplify if needed:\n\n${User_Course_Input}\n\nCourse Title\nCourse Objective\nModule 1 Title\nModule 1 Search Prompt\nModule 2 Title\nModule 2 Search Prompt\n.....`;\n  try {\n    console.log(\"Sending request to OpenAI API\");\n    const response = await axios.post(\n      \"https://api.openai.com/v1/chat/completions\",\n      {\n        model: \"gpt-3.5-turbo\",\n        messages: [{ role: \"user\", content: prompt }],\n        temperature: 0.7\n      },\n      {\n        headers: {\n          \"Authorization\": `Bearer ${private_env.OPENAI_API_KEY}`,\n          \"Content-Type\": \"application/json\"\n        }\n      }\n    );\n    console.log(\"Received response from OpenAI API\");\n    const content = response.data.choices[0].message.content;\n    const lines = content.split(\"\\n\").filter((line) => line.trim() !== \"\");\n    const courseStructure = {\n      OG_Course_Title: lines[0].replace(/^Course Title:\\s*/, \"\"),\n      OG_Course_Objective: lines[1].replace(/^Course Objective:\\s*/, \"\"),\n      OG_Module_Title: [],\n      OG_Module_YouTube_Search_Prompt: []\n    };\n    for (let i = 2; i < lines.length && courseStructure.OG_Module_Title.length < 10; i += 2) {\n      const moduleTitle = lines[i].replace(/^Module \\d+ Title:\\s*/, \"\").replace(/^Module \\d+:\\s*/, \"\");\n      const searchPrompt = lines[i + 1].replace(/^Module \\d+ Search Prompt:\\s*/, \"\").replace(/^Search Prompt:\\s*/, \"\").replace(/[\"\\\\\\n]/g, \"\");\n      courseStructure.OG_Module_Title.push(moduleTitle);\n      courseStructure.OG_Module_YouTube_Search_Prompt.push(searchPrompt);\n    }\n    if (!courseStructure.OG_Course_Title || !courseStructure.OG_Course_Objective || courseStructure.OG_Module_Title.length === 0) {\n      throw new Error(\"Invalid course structure generated\");\n    }\n    return courseStructure;\n  } catch (error) {\n    console.error(\"Error in generateCourse:\", error);\n    if (error.response) {\n      console.error(\"OpenAI API response:\", error.response.data);\n    }\n    throw new Error(`Failed to generate course: ${error.message}`);\n  }\n}\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}