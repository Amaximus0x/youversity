{"version":3,"file":"hooks.server-CgSyaeMv.js","sources":["../../../.svelte-kit/adapter-node/chunks/hooks.server.js"],"sourcesContent":["import { getAuth } from \"firebase-admin/auth\";\nimport { a as adminApp } from \"./firebase-admin.js\";\nconst handle = async ({ event, resolve }) => {\n  try {\n    const token = event.cookies.get(\"firebase-token\");\n    if (token && adminApp.auth) {\n      const auth = getAuth(adminApp);\n      try {\n        const decodedToken = await auth.verifyIdToken(token);\n        event.locals.user = decodedToken;\n      } catch (tokenError) {\n        console.error(\"Token verification error:\", tokenError);\n        event.locals.user = null;\n      }\n    }\n  } catch (error) {\n    console.error(\"Auth error in hooks:\", error);\n    event.locals.user = null;\n  }\n  if (event.request.method === \"OPTIONS\") {\n    return new Response(null, {\n      headers: {\n        \"Access-Control-Allow-Methods\": \"GET, POST, PUT, DELETE, OPTIONS\",\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Headers\": \"*\"\n      }\n    });\n  }\n  const response = await resolve(event);\n  const newHeaders = new Headers(response.headers);\n  newHeaders.set(\"Access-Control-Allow-Origin\", \"*\");\n  return new Response(response.body, {\n    status: response.status,\n    statusText: response.statusText,\n    headers: newHeaders\n  });\n};\nif (process.env.NODE_ENV === \"production\") {\n  process.env.PORT = \"3000\";\n  process.env.HOST = \"0.0.0.0\";\n}\nprocess.on(\"SIGTERM\", () => {\n  console.log(\"Received SIGTERM signal. Performing graceful shutdown...\");\n  process.exit(0);\n});\nprocess.on(\"SIGINT\", () => {\n  console.log(\"Received SIGINT signal. Performing graceful shutdown...\");\n  process.exit(0);\n});\nprocess.on(\"uncaughtException\", (error) => {\n  console.error(\"Uncaught Exception:\", error);\n  process.exit(1);\n});\nprocess.on(\"unhandledRejection\", (reason, promise) => {\n  console.error(\"Unhandled Rejection at:\", promise, \"reason:\", reason);\n  process.exit(1);\n});\nexport {\n  handle\n};\n"],"names":[],"mappings":";;;;;AAEK,MAAC,MAAM,GAAG,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK;AAC7C,EAAE,IAAI;AACN,IAAI,MAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC;AACrD,IAAI,IAAI,KAAK,IAAI,QAAQ,CAAC,IAAI,EAAE;AAChC,MAAM,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC;AACpC,MAAM,IAAI;AACV,QAAQ,MAAM,YAAY,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC;AAC5D,QAAQ,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG,YAAY;AACxC,OAAO,CAAC,OAAO,UAAU,EAAE;AAC3B,QAAQ,OAAO,CAAC,KAAK,CAAC,2BAA2B,EAAE,UAAU,CAAC;AAC9D,QAAQ,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI;AAChC;AACA;AACA,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,sBAAsB,EAAE,KAAK,CAAC;AAChD,IAAI,KAAK,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI;AAC5B;AACA,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,KAAK,SAAS,EAAE;AAC1C,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE;AAC9B,MAAM,OAAO,EAAE;AACf,QAAQ,8BAA8B,EAAE,iCAAiC;AACzE,QAAQ,6BAA6B,EAAE,GAAG;AAC1C,QAAQ,8BAA8B,EAAE;AACxC;AACA,KAAK,CAAC;AACN;AACA,EAAE,MAAM,QAAQ,GAAG,MAAM,OAAO,CAAC,KAAK,CAAC;AACvC,EAAE,MAAM,UAAU,GAAG,IAAI,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC;AAClD,EAAE,UAAU,CAAC,GAAG,CAAC,6BAA6B,EAAE,GAAG,CAAC;AACpD,EAAE,OAAO,IAAI,QAAQ,CAAC,QAAQ,CAAC,IAAI,EAAE;AACrC,IAAI,MAAM,EAAE,QAAQ,CAAC,MAAM;AAC3B,IAAI,UAAU,EAAE,QAAQ,CAAC,UAAU;AACnC,IAAI,OAAO,EAAE;AACb,GAAG,CAAC;AACJ;AACA,IAAI,OAAO,CAAC,GAAG,CAAC,QAAQ,KAAK,YAAY,EAAE;AAC3C,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,GAAG,MAAM;AAC3B,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,GAAG,SAAS;AAC9B;AACA,OAAO,CAAC,EAAE,CAAC,SAAS,EAAE,MAAM;AAC5B,EAAE,OAAO,CAAC,GAAG,CAAC,0DAA0D,CAAC;AACzE,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;AACF,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE,MAAM;AAC3B,EAAE,OAAO,CAAC,GAAG,CAAC,yDAAyD,CAAC;AACxE,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;AACF,OAAO,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC,KAAK,KAAK;AAC3C,EAAE,OAAO,CAAC,KAAK,CAAC,qBAAqB,EAAE,KAAK,CAAC;AAC7C,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;AACF,OAAO,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC,MAAM,EAAE,OAAO,KAAK;AACtD,EAAE,OAAO,CAAC,KAAK,CAAC,yBAAyB,EAAE,OAAO,EAAE,SAAS,EAAE,MAAM,CAAC;AACtE,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;AACjB,CAAC,CAAC;;;;"}