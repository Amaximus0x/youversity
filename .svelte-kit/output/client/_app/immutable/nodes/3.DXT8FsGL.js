import{e as E,a as M,t as $,s as _e,b as ye}from"../chunks/disclose-version.D7tGBA4G.js";import{aH as we,aD as xe,h as ke,ax as je,ab as Ve,n as Te,s as w,c as d,t as A,r as n,p as J,g as l,d as u,a as q,m as P,aI as Ee,f as le,aJ as Oe}from"../chunks/utils.DcsKdZEZ.js";import{i as N}from"../chunks/if.C26WOn-M.js";import{i as K}from"../chunks/lifecycle.BCvgLVFS.js";import{s as S}from"../chunks/render.Cil4iE76.js";import{a as Se,r as Pe,b as Me,s as re}from"../chunks/attributes.CT2dYRmI.js";import{p as O}from"../chunks/props.OFLBkJCG.js";import{e as ne,i as ce}from"../chunks/each.DNJP5h5E.js";import{o as $e}from"../chunks/index-client.Buh_srdv.js";import{u as Ce}from"../chunks/auth.C_d8jTao.js";import"../chunks/entry.bDmjVCi5.js";function Ue(e,t,i){if(i){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}function Ae(e,t,i,a=i){e.addEventListener(t,i);const r=e.__on_r;r?e.__on_r=()=>{r(),a()}:e.__on_r=a,Se()}function ve(e,t,i=t){var a=we();Ae(e,"input",()=>{var r=de(e)?ue(e.value):e.value;i(r),a&&r!==(r=t())&&(e.value=r??"")}),xe(()=>{var r=t();if(ke&&e.defaultValue!==e.value){i(e.value);return}de(e)&&r===ue(e.value)||e.type==="date"&&!r&&!e.value||r!==e.value&&(e.value=r??"")})}function de(e){var t=e.type;return t==="number"||t==="range"}function ue(e){return e===""?null:+e}function Fe(e,t,i){var a=Ve(e,t);a&&a.set&&(e[t]=i,je(()=>{e[t]=null}))}function Ie(e){return function(...t){var i=t[0];return i.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Re(e,t){var o;var i=(o=e.$$events)==null?void 0:o[t.type],a=Te(i)?i.slice():i==null?[]:[i];for(var r of a)r.call(this,t)}var Ge=$('<div class="text-red-500 mb-4"> </div>'),Le=$('<div class="max-w-2xl mx-auto"><div class="mb-6"><label for="objective" class="block text-lg mb-2">Enter your course objective</label> <textarea id="objective" class="w-full p-3 border rounded-lg min-h-[120px]" placeholder="e.g., Learn Python for Data Science"></textarea></div> <!> <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50"> </button></div>');function Ye(e,t){let i=O(t,"courseObjective",12),a=O(t,"loading",8),r=O(t,"error",8),o=O(t,"onSubmit",8);var s=Le(),h=d(s),k=w(d(h),2);Pe(k),n(h);var c=w(h,2);N(c,r,g=>{var C=Ge(),R=d(C,!0);n(C),A(()=>S(R,r())),M(g,C)});var f=w(c,2),v=d(f,!0);n(f),n(s),A(()=>{k.disabled=a(),f.disabled=a()||!i(),S(v,a()?"Building...":"Build My Course")}),ve(k,i),E("click",f,function(...g){var C;(C=o())==null||C.apply(this,g)}),M(e,s)}var Be=$('<p class="text-red-500 text-sm mt-1"> </p>'),Ne=$('<div class="mt-4"><div class="flex gap-2"><input type="text" placeholder="Paste YouTube URL" class="flex-1 p-2 border rounded"> <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:opacity-50"> </button></div> <!></div>');function ze(e,t){J(t,!1);let i=O(t,"moduleIndex",8),a=O(t,"onVideoAdd",8),r=P(""),o=P(""),s=P(!1);function h(y){const j=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,V=y.match(j);return V&&V[7].length===11?V[7]:null}async function k(){u(o,""),u(s,!0);try{const y=h(l(r));if(!y){u(o,"Invalid YouTube URL");return}const j=await fetch(`/api/video-metadata?videoId=${y}`);if(!j.ok)throw new Error("Failed to fetch video details");const V=await j.json(),Q={videoId:y,videoUrl:l(r),title:V.title,description:"User-added video",length:V.duration,thumbnailUrl:`https://img.youtube.com/vi/${y}/maxresdefault.jpg`};a()(Q,i()),u(r,"")}catch(y){console.error("Error adding video:",y),u(o,"Failed to add video. Please try again.")}finally{u(s,!1)}}K();var c=Ne(),f=d(c),v=d(f);Me(v);var g=w(v,2),C=d(g,!0);n(g),n(f);var R=w(f,2);N(R,()=>l(o),y=>{var j=Be(),V=d(j,!0);n(j),A(()=>S(V,l(o))),M(y,j)}),n(c),A(()=>{v.disabled=l(s),g.disabled=l(s),S(C,l(s)?"Adding...":"Add")}),ve(v,()=>l(r),y=>u(r,y)),E("click",g,k),M(e,c),q()}var De=$('<div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" role="dialog" aria-modal="true"><div class="relative w-full max-w-4xl aspect-video" role="presentation"><button class="absolute -top-10 right-0 text-white hover:text-gray-300">Close</button> <iframe title="YouTube video player" class="w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div>');function He(e,t){J(t,!1);let i=O(t,"videoId",8),a=O(t,"onClose",8);function r(c){c.key==="Escape"&&a()()}K();var o=De();E("keydown",Ee,r);var s=d(o),h=d(s),k=w(h,2);n(s),n(o),A(()=>re(k,"src",`https://www.youtube.com/embed/${i()}`)),E("click",h,function(...c){var f;(f=a())==null||f.apply(this,c)}),E("click",s,Ie(function(c){Re.call(this,t,c)})),E("click",o,function(...c){var f;(f=a())==null||f.apply(this,c)}),E("keydown",o,c=>{c.key==="Escape"&&a()()}),M(e,o),q()}async function Je(e,t=3){const i=a=>new Promise(r=>setTimeout(r,a));for(let a=0;a<t;a++)try{const r=await fetch(`/api/video-transcript?videoId=${e}`,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const o=await r.json();if(o.transcript==="No transcript available for this video"&&(console.log(`Attempt ${a+1}: No transcript for ${e}`),a<t-1)){await i(1e3*(a+1));continue}return o.transcript}catch(r){if(console.error(`Attempt ${a+1}: Error fetching transcript for ${e}:`,r),a<t-1){await i(1e3*(a+1));continue}}return"No transcript available after multiple attempts"}var qe=$('<div class="relative"><button class="p-4 border rounded-lg hover:border-blue-500 transition-colors w-full text-left"><div role="button" tabindex="0" class="relative cursor-pointer"><img class="w-full h-48 object-cover mb-2 rounded"> <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-50 transition-opacity"><svg class="w-16 h-16 text-white opacity-0 hover:opacity-100" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg></div></div> <div role="button" tabindex="0" class="mt-2"><h4 class="font-semibold mb-1"> </h4> <p class="text-sm text-gray-600"> </p></div></button></div>'),Ke=$('<div class="grid grid-cols-1 md:grid-cols-3 gap-4"></div> <!> <!>',1),Qe=$('<div class="text-center py-4"> </div>'),We=$('<div class="mb-8 p-4 bg-gray-50 rounded-lg"><h3 class="text-xl font-semibold mb-2"> </h3> <!></div>'),Xe=$('<div><h2 class="text-2xl font-bold mb-6"> </h2> <p class="mb-8"> </p> <!></div> <div class="mt-8 flex justify-end"><button class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50"> </button></div>',1);function Ze(e,t){J(t,!1);const i=_e(),a=()=>ye(Ce,"$user",i);let r=O(t,"courseStructure",8),o=O(t,"moduleVideos",12),s=O(t,"selectedVideos",12),h=O(t,"error",12);const k=!1;let c=P(!1),f=0,v=P(null);async function g(b,x,_=0){try{const p=r().OG_Module_Title[x],T=await fetch(`/api/search-videos?query=${encodeURIComponent(b)}&moduleTitle=${encodeURIComponent(p)}&moduleIndex=${x}&retry=${_}`,{headers:{Accept:"application/json","Cross-Origin-Opener-Policy":"same-origin"}});if(!T.ok)throw new Error("Failed to fetch videos");const I=await T.json();if(!I.videos.some(U=>U.videoId!=="")&&_<3)return console.log(`Retrying module ${x+1}, attempt ${_+1}`),await new Promise(U=>setTimeout(U,1e3)),g(b,x,_+1);o(o()[x]=I.videos,!0),s()[x]===void 0&&s(s()[x]=0,!0),o([...o()]),s([...s()])}catch(p){if(console.error(`Error in module ${x+1}:`,p),_<3)return await new Promise(T=>setTimeout(T,1e3)),g(b,x,_+1);h(`Failed to fetch videos for module ${x+1}`)}}async function C(){try{if(!a())throw new Error("Please sign in to save the course");if(u(c,!0),h(null),console.log("Starting save process..."),s().some(m=>m===void 0))throw new Error("Please select a video for each module");console.log("Fetching transcripts...");const b=s().map(async(m,p)=>{const T=o()[p][m];try{const I=await Je(T.videoId);return console.log(`Successfully fetched transcript for module ${p+1}`),{moduleIndex:p,videoId:T.videoId,title:T.title,transcript:I}}catch(I){return console.error(`Error fetching transcript for module ${p+1}:`,I),{moduleIndex:p,videoId:T.videoId,title:T.title,transcript:"Failed to fetch transcript"}}});(await Promise.allSettled(b)).forEach((m,p)=>{m.status==="fulfilled"?console.log(`Module ${p+1} Transcript:`,{videoId:m.value.videoId,title:m.value.title,transcript:m.value.transcript.substring(0,100)+"..."}):console.error(`Failed to fetch transcript for module ${p+1}:`,m.reason)});const _=s().map((m,p)=>({title:o()[p][m].title,videoUrl:o()[p][m].videoUrl,thumbnailUrl:o()[p][m].thumbnailUrl,videoId:o()[p][m].videoId}));console.log("Selected videos:",_)}catch(b){console.error("Save course error:",b),h(b instanceof Error?b.message:"An unknown error occurred")}finally{u(c,!1)}}const R=()=>r()?f>0&&f<=r().OG_Module_Title.length?`Fetching videos for Module ${f}`:"Preparing your final course...":"Building course structure...";$e(async()=>{try{for(let b=0;b<r().OG_Module_Title.length;(b+=1)-1)f=b+1,await g(r().OG_Module_YouTube_Search_Prompt[b],b);f=0}catch(b){console.error("Error in onMount:",b),h("Failed to initialize course videos")}}),K();var y=Xe(),j=le(y),V=d(j),Q=d(V,!0);n(V);var W=w(V,2),fe=d(W,!0);n(W);var be=w(W,2);ne(be,1,()=>r().OG_Module_Title,ce,(b,x,_)=>{var m=We(),p=d(m),T=d(p);n(p);var I=w(p,2);N(I,()=>o()[_],D=>{var U=Ke(),G=le(U);ne(G,5,()=>o()[_],ce,(L,F,X)=>{var Z=qe(),ee=d(Z),Y=d(ee),ie=d(Y);Oe(2),n(Y);var H=w(Y,2),te=d(H),me=d(te,!0);n(te);var se=w(te,2),he=d(se);n(se),n(H),n(ee),n(Z),A(()=>{Ue(ee,"border-blue-500",s()[_]===X),re(ie,"src",l(F).thumbnailUrl),re(ie,"alt",l(F).title),S(me,l(F).title),S(he,`${l(F).length??""} minutes`)}),E("click",Y,()=>u(v,l(F).videoId)),E("keydown",Y,B=>{(B.key==="Enter"||B.key===" ")&&u(v,l(F).videoId)}),E("click",H,()=>s(s()[_]=X,!0)),E("keydown",H,B=>{(B.key==="Enter"||B.key===" ")&&s(s()[_]=X,!0)}),M(L,Z)}),n(G);var ae=w(G,2);N(ae,()=>l(v),L=>{He(L,{get videoId(){return l(v)},onClose:()=>u(v,null)})});var ge=w(ae,2);ze(ge,{moduleIndex:_,onVideoAdd:(L,F)=>{o(o()[F]=[...o()[F],L],!0),o([...o()])}}),M(D,U)},D=>{var U=Qe(),G=d(U,!0);A(()=>S(G,R())),n(U),M(D,U)}),n(m),A(()=>S(T,`Module ${_+1}: ${l(x)??""}`)),M(b,m)}),n(j);var oe=w(j,2),z=d(oe);A(()=>z.disabled=l(c)||s().some(b=>b===void 0));var pe=d(z,!0);return n(z),n(oe),A(()=>{S(Q,r().OG_Course_Title),S(fe,r().OG_Course_Objective),S(pe,l(c)?"Saving...":"Save Course")}),E("click",z,C),M(e,y),Fe(t,"loading",k),q({loading:k})}var et=$('<div class="container mx-auto px-4 py-8"><h1 class="text-3xl font-bold mb-8">Create Your Course</h1> <!></div>');function vt(e,t){J(t,!1);let i=P(""),a=P(null),r=P(!1),o=P(null),s=P([]),h=P([]);async function k(){u(r,!0),u(o,null),u(s,[]),u(h,[]);try{const v=await fetch("/api/generate-course",{method:"POST",headers:{"Content-Type":"application/json","Cross-Origin-Opener-Policy":"same-origin"},body:JSON.stringify({objective:l(i)})});if(!v.ok){const g=await v.json();throw new Error(g.error||"Failed to generate course")}u(a,await v.json()),u(h,new Array(l(a).OG_Module_Title.length).fill(0))}catch(v){console.error("Error building course:",v),u(o,v.message),u(a,null)}finally{u(r,!1)}}K();var c=et(),f=w(d(c),2);N(f,()=>!l(a),v=>{Ye(v,{get courseObjective(){return l(i)},set courseObjective(g){u(i,g)},get loading(){return l(r)},get error(){return l(o)},onSubmit:k,$$legacy:!0})},v=>{Ze(v,{get courseStructure(){return l(a)},get moduleVideos(){return l(s)},set moduleVideos(g){u(s,g)},get selectedVideos(){return l(h)},set selectedVideos(g){u(h,g)},get loading(){return l(r)},get error(){return l(o)},$$legacy:!0})}),n(c),M(e,c),q()}export{vt as component};
