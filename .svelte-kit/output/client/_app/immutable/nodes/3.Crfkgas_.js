import{e as S,a as M,t as P,s as _e,b as ye}from"../chunks/disclose-version.D7tGBA4G.js";import{aH as we,aD as xe,h as ke,ax as je,ab as Ve,n as Oe,s as w,c as d,t as F,r as n,p as q,g as l,d as u,a as H,m as $,aI as Se,f as le,aJ as Ee}from"../chunks/utils.DcsKdZEZ.js";import{i as B}from"../chunks/if.C26WOn-M.js";import{i as K}from"../chunks/lifecycle.BCvgLVFS.js";import{s as T}from"../chunks/render.Cil4iE76.js";import{a as Te,r as $e,b as Me,s as re}from"../chunks/attributes.CT2dYRmI.js";import{p as E}from"../chunks/props.OFLBkJCG.js";import{e as ne,i as ce}from"../chunks/each.DNJP5h5E.js";import{o as Pe}from"../chunks/index-client.Buh_srdv.js";import{u as Ce}from"../chunks/auth.x_EDYfZ2.js";import"../chunks/entry.BZKgMnzz.js";function Ue(e,t,i){if(i){if(e.classList.contains(t))return;e.classList.add(t)}else{if(!e.classList.contains(t))return;e.classList.remove(t)}}function Fe(e,t,i,a=i){e.addEventListener(t,i);const o=e.__on_r;o?e.__on_r=()=>{o(),a()}:e.__on_r=a,Te()}function ve(e,t,i=t){var a=we();Fe(e,"input",()=>{var o=de(e)?ue(e.value):e.value;i(o),a&&o!==(o=t())&&(e.value=o??"")}),xe(()=>{var o=t();if(ke&&e.defaultValue!==e.value){i(e.value);return}de(e)&&o===ue(e.value)||e.type==="date"&&!o&&!e.value||o!==e.value&&(e.value=o??"")})}function de(e){var t=e.type;return t==="number"||t==="range"}function ue(e){return e===""?null:+e}function Ae(e,t,i){var a=Ve(e,t);a&&a.set&&(e[t]=i,je(()=>{e[t]=null}))}function Ie(e){return function(...t){var i=t[0];return i.stopPropagation(),e==null?void 0:e.apply(this,t)}}function Ge(e,t){var r;var i=(r=e.$$events)==null?void 0:r[t.type],a=Oe(i)?i.slice():i==null?[]:[i];for(var o of a)o.call(this,t)}var Le=P('<div class="text-red-500 mb-4"> </div>'),Re=P('<div class="max-w-2xl mx-auto"><div class="mb-6"><label for="objective" class="block text-lg mb-2">Enter your course objective</label> <textarea id="objective" class="w-full p-3 border rounded-lg min-h-[120px]" placeholder="e.g., Learn Python for Data Science"></textarea></div> <!> <button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50"> </button></div>');function Ye(e,t){let i=E(t,"courseObjective",12),a=E(t,"loading",8),o=E(t,"error",8),r=E(t,"onSubmit",8);var s=Re(),h=d(s),k=w(d(h),2);$e(k),n(h);var c=w(h,2);B(c,o,g=>{var C=Le(),G=d(C,!0);n(C),F(()=>T(G,o())),M(g,C)});var f=w(c,2),v=d(f,!0);n(f),n(s),F(()=>{k.disabled=a(),f.disabled=a()||!i(),T(v,a()?"Building...":"Build My Course")}),ve(k,i),S("click",f,function(...g){var C;(C=r())==null||C.apply(this,g)}),M(e,s)}var Ne=P('<p class="text-red-500 text-sm mt-1"> </p>'),Be=P('<div class="mt-4"><div class="flex gap-2"><input type="text" placeholder="Paste YouTube URL" class="flex-1 p-2 border rounded"> <button class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:opacity-50"> </button></div> <!></div>');function ze(e,t){q(t,!1);let i=E(t,"moduleIndex",8),a=E(t,"onVideoAdd",8),o=$(""),r=$(""),s=$(!1);function h(y){const j=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,V=y.match(j);return V&&V[7].length===11?V[7]:null}async function k(){u(r,""),u(s,!0);try{const y=h(l(o));if(!y){u(r,"Invalid YouTube URL");return}const j=await fetch(`/api/video-metadata?videoId=${y}`);if(!j.ok)throw new Error("Failed to fetch video details");const V=await j.json(),Q={videoId:y,videoUrl:l(o),title:V.title,description:"User-added video",length:V.duration,thumbnailUrl:`https://img.youtube.com/vi/${y}/maxresdefault.jpg`};a()(Q,i()),u(o,"")}catch(y){console.error("Error adding video:",y),u(r,"Failed to add video. Please try again.")}finally{u(s,!1)}}K();var c=Be(),f=d(c),v=d(f);Me(v);var g=w(v,2),C=d(g,!0);n(g),n(f);var G=w(f,2);B(G,()=>l(r),y=>{var j=Ne(),V=d(j,!0);n(j),F(()=>T(V,l(r))),M(y,j)}),n(c),F(()=>{v.disabled=l(s),g.disabled=l(s),T(C,l(s)?"Adding...":"Add")}),ve(v,()=>l(o),y=>u(o,y)),S("click",g,k),M(e,c),H()}var De=P('<div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" role="dialog" aria-modal="true"><div class="relative w-full max-w-4xl aspect-video" role="presentation"><button class="absolute -top-10 right-0 text-white hover:text-gray-300">Close</button> <iframe title="YouTube video player" class="w-full h-full" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div>');function Je(e,t){q(t,!1);let i=E(t,"videoId",8),a=E(t,"onClose",8);function o(c){c.key==="Escape"&&a()()}K();var r=De();S("keydown",Se,o);var s=d(r),h=d(s),k=w(h,2);n(s),n(r),F(()=>re(k,"src",`https://www.youtube.com/embed/${i()}`)),S("click",h,function(...c){var f;(f=a())==null||f.apply(this,c)}),S("click",s,Ie(function(c){Ge.call(this,t,c)})),S("click",r,function(...c){var f;(f=a())==null||f.apply(this,c)}),S("keydown",r,c=>{c.key==="Escape"&&a()()}),M(e,r),H()}async function qe(e,t=3){const i=a=>new Promise(o=>setTimeout(o,a));for(let a=0;a<t;a++)try{const r=await(await fetch(`/api/video-transcript?videoId=${e}`)).json();if(r.error){if(console.log(`Attempt ${a+1}: Transcript error for ${e}:`,r.error),a<t-1){await i(1e3*(a+1));continue}return`No transcript available: ${r.details||r.error}`}if((!r.transcript||r.transcript==="No transcript available for this video")&&(console.log(`Attempt ${a+1}: No transcript for ${e}`),a<t-1)){await i(1e3*(a+1));continue}return r.transcript||"No transcript available"}catch(o){if(console.error(`Attempt ${a+1}: Error fetching transcript for ${e}:`,o),a<t-1){await i(1e3*(a+1));continue}return"Failed to fetch transcript"}return"No transcript available after multiple attempts"}var He=P('<div class="relative"><button class="p-4 border rounded-lg hover:border-blue-500 transition-colors w-full text-left"><div role="button" tabindex="0" class="relative cursor-pointer"><img class="w-full h-48 object-cover mb-2 rounded"> <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-50 transition-opacity"><svg class="w-16 h-16 text-white opacity-0 hover:opacity-100" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg></div></div> <div role="button" tabindex="0" class="mt-2"><h4 class="font-semibold mb-1"> </h4> <p class="text-sm text-gray-600"> </p></div></button></div>'),Ke=P('<div class="grid grid-cols-1 md:grid-cols-3 gap-4"></div> <!> <!>',1),Qe=P('<div class="text-center py-4"> </div>'),We=P('<div class="mb-8 p-4 bg-gray-50 rounded-lg"><h3 class="text-xl font-semibold mb-2"> </h3> <!></div>'),Xe=P('<div><h2 class="text-2xl font-bold mb-6"> </h2> <p class="mb-8"> </p> <!></div> <div class="mt-8 flex justify-end"><button class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50"> </button></div>',1);function Ze(e,t){q(t,!1);const i=_e(),a=()=>ye(Ce,"$user",i);let o=E(t,"courseStructure",8),r=E(t,"moduleVideos",12),s=E(t,"selectedVideos",12),h=E(t,"error",12);const k=!1;let c=$(!1),f=0,v=$(null);async function g(b,x,_=0){try{const p=o().OG_Module_Title[x],O=await fetch(`/api/search-videos?query=${encodeURIComponent(b)}&moduleTitle=${encodeURIComponent(p)}&moduleIndex=${x}&retry=${_}`,{headers:{Accept:"application/json","Cross-Origin-Opener-Policy":"same-origin"}});if(!O.ok)throw new Error("Failed to fetch videos");const I=await O.json();if(!I.videos.some(U=>U.videoId!=="")&&_<3)return console.log(`Retrying module ${x+1}, attempt ${_+1}`),await new Promise(U=>setTimeout(U,1e3)),g(b,x,_+1);r(r()[x]=I.videos,!0),s()[x]===void 0&&s(s()[x]=0,!0),r([...r()]),s([...s()])}catch(p){if(console.error(`Error in module ${x+1}:`,p),_<3)return await new Promise(O=>setTimeout(O,1e3)),g(b,x,_+1);h(`Failed to fetch videos for module ${x+1}`)}}async function C(){try{if(!a())throw new Error("Please sign in to save the course");if(u(c,!0),h(null),console.log("Starting save process..."),s().some(m=>m===void 0))throw new Error("Please select a video for each module");console.log("Fetching transcripts...");const b=s().map(async(m,p)=>{const O=r()[p][m];try{const I=await qe(O.videoId);return console.log(`Successfully fetched transcript for module ${p+1}`),{moduleIndex:p,videoId:O.videoId,title:O.title,transcript:I}}catch(I){return console.error(`Error fetching transcript for module ${p+1}:`,I),{moduleIndex:p,videoId:O.videoId,title:O.title,transcript:"Failed to fetch transcript"}}});(await Promise.allSettled(b)).forEach((m,p)=>{m.status==="fulfilled"?console.log(`Module ${p+1} Transcript:`,{videoId:m.value.videoId,title:m.value.title,transcript:m.value.transcript.substring(0,100)+"..."}):console.error(`Failed to fetch transcript for module ${p+1}:`,m.reason)});const _=s().map((m,p)=>({title:r()[p][m].title,videoUrl:r()[p][m].videoUrl,thumbnailUrl:r()[p][m].thumbnailUrl,videoId:r()[p][m].videoId}));console.log("Selected videos:",_)}catch(b){console.error("Save course error:",b),h(b instanceof Error?b.message:"An unknown error occurred")}finally{u(c,!1)}}const G=()=>o()?f>0&&f<=o().OG_Module_Title.length?`Fetching videos for Module ${f}`:"Preparing your final course...":"Building course structure...";Pe(async()=>{try{for(let b=0;b<o().OG_Module_Title.length;(b+=1)-1)f=b+1,await g(o().OG_Module_YouTube_Search_Prompt[b],b);f=0}catch(b){console.error("Error in onMount:",b),h("Failed to initialize course videos")}}),K();var y=Xe(),j=le(y),V=d(j),Q=d(V,!0);n(V);var W=w(V,2),fe=d(W,!0);n(W);var be=w(W,2);ne(be,1,()=>o().OG_Module_Title,ce,(b,x,_)=>{var m=We(),p=d(m),O=d(p);n(p);var I=w(p,2);B(I,()=>r()[_],D=>{var U=Ke(),L=le(U);ne(L,5,()=>r()[_],ce,(R,A,X)=>{var Z=He(),ee=d(Z),Y=d(ee),ie=d(Y);Ee(2),n(Y);var J=w(Y,2),te=d(J),me=d(te,!0);n(te);var se=w(te,2),he=d(se);n(se),n(J),n(ee),n(Z),F(()=>{Ue(ee,"border-blue-500",s()[_]===X),re(ie,"src",l(A).thumbnailUrl),re(ie,"alt",l(A).title),T(me,l(A).title),T(he,`${l(A).length??""} minutes`)}),S("click",Y,()=>u(v,l(A).videoId)),S("keydown",Y,N=>{(N.key==="Enter"||N.key===" ")&&u(v,l(A).videoId)}),S("click",J,()=>s(s()[_]=X,!0)),S("keydown",J,N=>{(N.key==="Enter"||N.key===" ")&&s(s()[_]=X,!0)}),M(R,Z)}),n(L);var ae=w(L,2);B(ae,()=>l(v),R=>{Je(R,{get videoId(){return l(v)},onClose:()=>u(v,null)})});var ge=w(ae,2);ze(ge,{moduleIndex:_,onVideoAdd:(R,A)=>{r(r()[A]=[...r()[A],R],!0),r([...r()])}}),M(D,U)},D=>{var U=Qe(),L=d(U,!0);F(()=>T(L,G())),n(U),M(D,U)}),n(m),F(()=>T(O,`Module ${_+1}: ${l(x)??""}`)),M(b,m)}),n(j);var oe=w(j,2),z=d(oe);F(()=>z.disabled=l(c)||s().some(b=>b===void 0));var pe=d(z,!0);return n(z),n(oe),F(()=>{T(Q,o().OG_Course_Title),T(fe,o().OG_Course_Objective),T(pe,l(c)?"Saving...":"Save Course")}),S("click",z,C),M(e,y),Ae(t,"loading",k),H({loading:k})}var et=P('<div class="container mx-auto px-4 py-8"><h1 class="text-3xl font-bold mb-8">Create Your Course</h1> <!></div>');function vt(e,t){q(t,!1);let i=$(""),a=$(null),o=$(!1),r=$(null),s=$([]),h=$([]);async function k(){u(o,!0),u(r,null),u(s,[]),u(h,[]);try{const v=await fetch("/api/generate-course",{method:"POST",headers:{"Content-Type":"application/json","Cross-Origin-Opener-Policy":"same-origin"},body:JSON.stringify({objective:l(i)})});if(!v.ok){const g=await v.json();throw new Error(g.error||"Failed to generate course")}u(a,await v.json()),u(h,new Array(l(a).OG_Module_Title.length).fill(0))}catch(v){console.error("Error building course:",v),u(r,v.message),u(a,null)}finally{u(o,!1)}}K();var c=et(),f=w(d(c),2);B(f,()=>!l(a),v=>{Ye(v,{get courseObjective(){return l(i)},set courseObjective(g){u(i,g)},get loading(){return l(o)},get error(){return l(r)},onSubmit:k,$$legacy:!0})},v=>{Ze(v,{get courseStructure(){return l(a)},get moduleVideos(){return l(s)},set moduleVideos(g){u(s,g)},get selectedVideos(){return l(h)},set selectedVideos(g){u(h,g)},get loading(){return l(o)},get error(){return l(r)},$$legacy:!0})}),n(c),M(e,c),H()}export{vt as component};
