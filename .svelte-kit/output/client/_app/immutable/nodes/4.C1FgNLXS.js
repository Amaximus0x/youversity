import{s as x,i as me,n as J,r as de,a as se,z as Oe,h as ne,A as ie,c as ge,o as Ie}from"../chunks/scheduler.DhsztkH2.js";import{S as $,i as ee,e as k,s as M,t as U,c as V,a as j,k as fe,f as G,d as v,b as B,l as m,g as P,h as g,q as ae,m as L,j as H,D as je,E as ue,r as te,u as oe,v as re,w as z,B as he,A as _e,x as R,n as Te,y as le,F as pe}from"../chunks/index.DK03Zu-C.js";import{e as ce}from"../chunks/each.D6YF6ztN.js";import{d as Se}from"../chunks/firebase.D9dyBQNl.js";import{g as Me}from"../chunks/entry.XLM3-e4P.js";import{u as Ge}from"../chunks/auth.hjYb--ZN.js";import{C as Ae,l as D}from"../chunks/CourseGenerationProgress.ExnoVqK1.js";const De=!0,Pe=De;function be(o){let e,t;return{c(){e=k("div"),t=U(o[2]),this.h()},l(r){e=V(r,"DIV",{class:!0});var n=j(e);t=B(n,o[2]),n.forEach(v),this.h()},h(){m(e,"class","text-red-500 mb-4")},m(r,n){P(r,e,n),g(e,t)},p(r,n){n&4&&H(t,r[2])},d(r){r&&v(e)}}}function Ue(o){let e,t,r,n="Enter your course objective",u,l,c,s,f,h=o[1]?"Building...":"Build My Course",a,d,p,S,w=o[2]&&be(o);return{c(){e=k("div"),t=k("div"),r=k("label"),r.textContent=n,u=M(),l=k("input"),c=M(),w&&w.c(),s=M(),f=k("button"),a=U(h),this.h()},l(O){e=V(O,"DIV",{class:!0});var b=j(e);t=V(b,"DIV",{class:!0});var E=j(t);r=V(E,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),fe(r)!=="svelte-1ohawld"&&(r.textContent=n),u=G(E),l=V(E,"INPUT",{type:!0,id:!0,class:!0,placeholder:!0}),E.forEach(v),c=G(b),w&&w.l(b),s=G(b),f=V(b,"BUTTON",{class:!0});var I=j(f);a=B(I,h),I.forEach(v),b.forEach(v),this.h()},h(){m(r,"for","objective"),m(r,"class","block text-lg mb-2"),m(l,"type","text"),m(l,"id","objective"),m(l,"class","w-full p-3 border rounded-lg"),m(l,"placeholder","e.g., Learn Python for Data Science"),l.disabled=o[1],m(t,"class","mb-6"),f.disabled=d=o[1]||!o[0],m(f,"class","bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50"),m(e,"class","max-w-2xl mx-auto")},m(O,b){P(O,e,b),g(e,t),g(t,r),g(t,u),g(t,l),ae(l,o[0]),g(e,c),w&&w.m(e,null),g(e,s),g(e,f),g(f,a),p||(S=[L(l,"input",o[4]),L(f,"click",function(){me(o[3])&&o[3].apply(this,arguments)})],p=!0)},p(O,[b]){o=O,b&2&&(l.disabled=o[1]),b&1&&l.value!==o[0]&&ae(l,o[0]),o[2]?w?w.p(o,b):(w=be(o),w.c(),w.m(e,s)):w&&(w.d(1),w=null),b&2&&h!==(h=o[1]?"Building...":"Build My Course")&&H(a,h),b&3&&d!==(d=o[1]||!o[0])&&(f.disabled=d)},i:J,o:J,d(O){O&&v(e),w&&w.d(),p=!1,de(S)}}}function Be(o,e,t){let{courseObjective:r}=e,{loading:n}=e,{error:u}=e,{onSubmit:l}=e;function c(){r=this.value,t(0,r)}return o.$$set=s=>{"courseObjective"in s&&t(0,r=s.courseObjective),"loading"in s&&t(1,n=s.loading),"error"in s&&t(2,u=s.error),"onSubmit"in s&&t(3,l=s.onSubmit)},[r,n,u,l,c]}class ze extends ${constructor(e){super(),ee(this,e,Be,Ue,x,{courseObjective:0,loading:1,error:2,onSubmit:3})}}function ve(o){let e,t;return{c(){e=k("p"),t=U(o[1]),this.h()},l(r){e=V(r,"P",{class:!0});var n=j(e);t=B(n,o[1]),n.forEach(v),this.h()},h(){m(e,"class","text-red-500 text-sm mt-1")},m(r,n){P(r,e,n),g(e,t)},p(r,n){n&2&&H(t,r[1])},d(r){r&&v(e)}}}function Fe(o){let e,t,r,n,u,l=o[2]?"Adding...":"Add",c,s,f,h,a=o[1]&&ve(o);return{c(){e=k("div"),t=k("div"),r=k("input"),n=M(),u=k("button"),c=U(l),s=M(),a&&a.c(),this.h()},l(d){e=V(d,"DIV",{class:!0});var p=j(e);t=V(p,"DIV",{class:!0});var S=j(t);r=V(S,"INPUT",{type:!0,placeholder:!0,class:!0}),n=G(S),u=V(S,"BUTTON",{class:!0});var w=j(u);c=B(w,l),w.forEach(v),S.forEach(v),s=G(p),a&&a.l(p),p.forEach(v),this.h()},h(){m(r,"type","text"),m(r,"placeholder","Paste YouTube URL"),m(r,"class","flex-1 p-2 border rounded"),r.disabled=o[2],u.disabled=o[2],m(u,"class","bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 disabled:opacity-50"),m(t,"class","flex gap-2"),m(e,"class","mt-4")},m(d,p){P(d,e,p),g(e,t),g(t,r),ae(r,o[0]),g(t,n),g(t,u),g(u,c),g(e,s),a&&a.m(e,null),f||(h=[L(r,"input",o[6]),L(u,"click",o[3])],f=!0)},p(d,[p]){p&4&&(r.disabled=d[2]),p&1&&r.value!==d[0]&&ae(r,d[0]),p&4&&l!==(l=d[2]?"Adding...":"Add")&&H(c,l),p&4&&(u.disabled=d[2]),d[1]?a?a.p(d,p):(a=ve(d),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i:J,o:J,d(d){d&&v(e),a&&a.d(),f=!1,de(h)}}}function Ne(o){const e=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,t=o.match(e);return t&&t[7].length===11?t[7]:null}function Le(o,e,t){let{moduleIndex:r}=e,{onVideoAdd:n}=e,u="",l="",c=!1;async function s(){t(1,l=""),t(2,c=!0);try{const h=Ne(u);if(!h){t(1,l="Invalid YouTube URL");return}const a=await fetch(`/api/video-metadata?videoId=${h}`);if(!a.ok)throw new Error("Failed to fetch video details");const d=await a.json(),p={videoId:h,videoUrl:u,title:d.title,description:"User-added video",length:d.duration,thumbnailUrl:`https://img.youtube.com/vi/${h}/maxresdefault.jpg`};n(p,r),t(0,u="")}catch(h){console.error("Error adding video:",h),t(1,l="Failed to add video. Please try again.")}finally{t(2,c=!1)}}function f(){u=this.value,t(0,u)}return o.$$set=h=>{"moduleIndex"in h&&t(4,r=h.moduleIndex),"onVideoAdd"in h&&t(5,n=h.onVideoAdd)},[u,l,c,s,r,n,f]}class Re extends ${constructor(e){super(),ee(this,e,Le,Fe,x,{moduleIndex:4,onVideoAdd:5})}}function qe(o){let e,t,r,n="Close",u,l,c,s,f;return{c(){e=k("div"),t=k("div"),r=k("button"),r.textContent=n,u=M(),l=k("iframe"),this.h()},l(h){e=V(h,"DIV",{class:!0,role:!0,"aria-modal":!0});var a=j(e);t=V(a,"DIV",{class:!0,role:!0});var d=j(t);r=V(d,"BUTTON",{class:!0,"data-svelte-h":!0}),fe(r)!=="svelte-160vk1q"&&(r.textContent=n),u=G(d),l=V(d,"IFRAME",{title:!0,src:!0,class:!0,frameborder:!0,allow:!0}),j(l).forEach(v),d.forEach(v),a.forEach(v),this.h()},h(){m(r,"class","absolute -top-10 right-0 text-white hover:text-gray-300"),m(l,"title","YouTube video player"),se(l.src,c=`https://www.youtube.com/embed/${o[0]}`)||m(l,"src",c),m(l,"class","w-full h-full"),m(l,"frameborder","0"),m(l,"allow","accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"),l.allowFullscreen=!0,m(t,"class","relative w-full max-w-4xl aspect-video"),m(t,"role","presentation"),m(e,"class","fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"),m(e,"role","dialog"),m(e,"aria-modal","true")},m(h,a){P(h,e,a),g(e,t),g(t,r),g(t,u),g(t,l),s||(f=[L(window,"keydown",o[2]),L(r,"click",function(){me(o[1])&&o[1].apply(this,arguments)}),L(t,"click",je(o[3])),L(e,"click",function(){me(o[1])&&o[1].apply(this,arguments)}),L(e,"keydown",o[4])],s=!0)},p(h,[a]){o=h,a&1&&!se(l.src,c=`https://www.youtube.com/embed/${o[0]}`)&&m(l,"src",c)},i:J,o:J,d(h){h&&v(e),s=!1,de(f)}}}function He(o,e,t){let{videoId:r}=e,{onClose:n}=e;function u(s){s.key==="Escape"&&n()}function l(s){Oe.call(this,o,s)}const c=s=>{s.key==="Escape"&&n()};return o.$$set=s=>{"videoId"in s&&t(0,r=s.videoId),"onClose"in s&&t(1,n=s.onClose)},[r,n,u,l,c]}class Ye extends ${constructor(e){super(),ee(this,e,He,qe,x,{videoId:0,onClose:1})}}async function Je(o,e=3){const t=r=>new Promise(n=>setTimeout(n,r));for(let r=0;r<e;r++)try{const n=await fetch(`/api/video-transcript?videoId=${o}`,{headers:{Accept:"application/json","Content-Type":"application/json"}});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const u=await n.json();if(u.transcript==="No transcript available for this video"&&(console.log(`Attempt ${r+1}: No transcript for ${o}`),r<e-1)){await t(2e3*Math.pow(2,r));continue}return u.transcript}catch(n){if(console.error(`Attempt ${r+1}: Error fetching transcript for ${o}:`,n),r<e-1){await t(2e3*Math.pow(2,r));continue}}return"No transcript available after multiple attempts"}function we(o,e,t){const r=o.slice();return r[25]=e[t],r[27]=t,r}function ye(o,e,t){const r=o.slice();return r[28]=e[t],r[30]=t,r}function Ke(o){let e,t=o[7]()+"",r;return{c(){e=k("div"),r=U(t),this.h()},l(n){e=V(n,"DIV",{class:!0});var u=j(e);r=B(u,t),u.forEach(v),this.h()},h(){m(e,"class","text-center py-4")},m(n,u){P(n,e,u),g(e,r)},p:J,i:J,o:J,d(n){n&&v(e)}}}function We(o){let e,t,r,n,u,l=ce(o[0][o[27]]),c=[];for(let f=0;f<l.length;f+=1)c[f]=ke(ye(o,l,f));let s=o[4]&&Ve(o);return n=new Re({props:{moduleIndex:o[27],onVideoAdd:o[15]}}),{c(){e=k("div");for(let f=0;f<c.length;f+=1)c[f].c();t=M(),s&&s.c(),r=M(),te(n.$$.fragment),this.h()},l(f){e=V(f,"DIV",{class:!0});var h=j(e);for(let a=0;a<c.length;a+=1)c[a].l(h);h.forEach(v),t=G(f),s&&s.l(f),r=G(f),oe(n.$$.fragment,f),this.h()},h(){m(e,"class","grid grid-cols-1 md:grid-cols-3 gap-4")},m(f,h){P(f,e,h);for(let a=0;a<c.length;a+=1)c[a]&&c[a].m(e,null);P(f,t,h),s&&s.m(f,h),P(f,r,h),re(n,f,h),u=!0},p(f,h){if(h&19){l=ce(f[0][f[27]]);let d;for(d=0;d<l.length;d+=1){const p=ye(f,l,d);c[d]?c[d].p(p,h):(c[d]=ke(p),c[d].c(),c[d].m(e,null))}for(;d<c.length;d+=1)c[d].d(1);c.length=l.length}f[4]?s?(s.p(f,h),h&16&&z(s,1)):(s=Ve(f),s.c(),z(s,1),s.m(r.parentNode,r)):s&&(he(),R(s,1,1,()=>{s=null}),_e());const a={};h&1&&(a.onVideoAdd=f[15]),n.$set(a)},i(f){u||(z(s),z(n.$$.fragment,f),u=!0)},o(f){R(s),R(n.$$.fragment,f),u=!1},d(f){f&&(v(e),v(t),v(r)),Te(c,f),s&&s.d(f),le(n,f)}}}function ke(o){let e,t,r,n,u,l,c,s,f='<svg class="w-16 h-16 text-white opacity-0 hover:opacity-100" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"></path></svg>',h,a,d,p=o[28].title+"",S,w,O,b=o[28].length+"",E,I,Y,K,q;function T(){return o[10](o[28])}function Q(...i){return o[11](o[28],...i)}function X(){return o[12](o[27],o[30])}function W(...i){return o[13](o[27],o[30],...i)}return{c(){e=k("div"),t=k("button"),r=k("div"),n=k("img"),c=M(),s=k("div"),s.innerHTML=f,h=M(),a=k("div"),d=k("h4"),S=U(p),w=M(),O=k("p"),E=U(b),I=U(" minutes"),Y=M(),this.h()},l(i){e=V(i,"DIV",{class:!0});var _=j(e);t=V(_,"BUTTON",{class:!0});var C=j(t);r=V(C,"DIV",{role:!0,tabindex:!0,class:!0});var y=j(r);n=V(y,"IMG",{src:!0,alt:!0,class:!0}),c=G(y),s=V(y,"DIV",{class:!0,"data-svelte-h":!0}),fe(s)!=="svelte-1qjeg74"&&(s.innerHTML=f),y.forEach(v),h=G(C),a=V(C,"DIV",{role:!0,tabindex:!0,class:!0});var A=j(a);d=V(A,"H4",{class:!0});var F=j(d);S=B(F,p),F.forEach(v),w=G(A),O=V(A,"P",{class:!0});var N=j(O);E=B(N,b),I=B(N," minutes"),N.forEach(v),A.forEach(v),C.forEach(v),Y=G(_),_.forEach(v),this.h()},h(){se(n.src,u=o[28].thumbnailUrl)||m(n,"src",u),m(n,"alt",l=o[28].title),m(n,"class","w-full h-48 object-cover mb-2 rounded"),m(s,"class","absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-50 transition-opacity"),m(r,"role","button"),m(r,"tabindex","0"),m(r,"class","relative cursor-pointer"),m(d,"class","font-semibold mb-1"),m(O,"class","text-sm text-gray-600"),m(a,"role","button"),m(a,"tabindex","0"),m(a,"class","mt-2"),m(t,"class","p-4 border rounded-lg hover:border-blue-500 transition-colors w-full text-left"),pe(t,"border-blue-500",o[1][o[27]]===o[30]),m(e,"class","relative")},m(i,_){P(i,e,_),g(e,t),g(t,r),g(r,n),g(r,c),g(r,s),g(t,h),g(t,a),g(a,d),g(d,S),g(a,w),g(a,O),g(O,E),g(O,I),g(e,Y),K||(q=[L(r,"click",T),L(r,"keydown",Q),L(a,"click",X),L(a,"keydown",W)],K=!0)},p(i,_){o=i,_&1&&!se(n.src,u=o[28].thumbnailUrl)&&m(n,"src",u),_&1&&l!==(l=o[28].title)&&m(n,"alt",l),_&1&&p!==(p=o[28].title+"")&&H(S,p),_&1&&b!==(b=o[28].length+"")&&H(E,b),_&2&&pe(t,"border-blue-500",o[1][o[27]]===o[30])},d(i){i&&v(e),K=!1,de(q)}}}function Ve(o){let e,t;return e=new Ye({props:{videoId:o[4],onClose:o[14]}}),{c(){te(e.$$.fragment)},l(r){oe(e.$$.fragment,r)},m(r,n){re(e,r,n),t=!0},p(r,n){const u={};n&16&&(u.videoId=r[4]),n&16&&(u.onClose=r[14]),e.$set(u)},i(r){t||(z(e.$$.fragment,r),t=!0)},o(r){R(e.$$.fragment,r),t=!1},d(r){le(e,r)}}}function Ee(o){let e,t,r,n=o[27]+1+"",u,l,c=o[25]+"",s,f,h,a,d,p;const S=[We,Ke],w=[];function O(b,E){return b[0][b[27]]?0:1}return h=O(o),a=w[h]=S[h](o),{c(){e=k("div"),t=k("h3"),r=U("Module "),u=U(n),l=U(": "),s=U(c),f=M(),a.c(),d=M(),this.h()},l(b){e=V(b,"DIV",{class:!0});var E=j(e);t=V(E,"H3",{class:!0});var I=j(t);r=B(I,"Module "),u=B(I,n),l=B(I,": "),s=B(I,c),I.forEach(v),f=G(E),a.l(E),d=G(E),E.forEach(v),this.h()},h(){m(t,"class","text-xl font-semibold mb-2"),m(e,"class","mb-8 p-4 bg-gray-50 rounded-lg")},m(b,E){P(b,e,E),g(e,t),g(t,r),g(t,u),g(t,l),g(t,s),g(e,f),w[h].m(e,null),g(e,d),p=!0},p(b,E){(!p||E&4)&&c!==(c=b[25]+"")&&H(s,c);let I=h;h=O(b),h===I?w[h].p(b,E):(he(),R(w[I],1,1,()=>{w[I]=null}),_e(),a=w[h],a?a.p(b,E):(a=w[h]=S[h](b),a.c()),z(a,1),a.m(e,d))},i(b){p||(z(a),p=!0)},o(b){R(a),p=!1},d(b){b&&v(e),w[h].d()}}}function Qe(o){let e,t,r=o[2].OG_Course_Title+"",n,u,l,c=o[2].OG_Course_Objective+"",s,f,h,a,d,p=o[3]?"Generating Course...":"Generate Final Course",S,w,O,b,E,I,Y,K,q=ce(o[2].OG_Module_Title),T=[];for(let i=0;i<q.length;i+=1)T[i]=Ee(we(o,q,i));const Q=i=>R(T[i],1,1,()=>{T[i]=null});function X(i){o[17](i)}let W={courseId:Xe};return o[5]!==void 0&&(W.minimized=o[5]),b=new Ae({props:W}),ne.push(()=>ue(b,"minimized",X)),{c(){e=k("div"),t=k("h2"),n=U(r),u=M(),l=k("p"),s=U(c),f=M();for(let i=0;i<T.length;i+=1)T[i].c();h=M(),a=k("div"),d=k("button"),S=U(p),O=M(),te(b.$$.fragment),this.h()},l(i){e=V(i,"DIV",{});var _=j(e);t=V(_,"H2",{class:!0});var C=j(t);n=B(C,r),C.forEach(v),u=G(_),l=V(_,"P",{class:!0});var y=j(l);s=B(y,c),y.forEach(v),f=G(_);for(let N=0;N<T.length;N+=1)T[N].l(_);_.forEach(v),h=G(i),a=V(i,"DIV",{class:!0});var A=j(a);d=V(A,"BUTTON",{class:!0});var F=j(d);S=B(F,p),F.forEach(v),A.forEach(v),O=G(i),oe(b.$$.fragment,i),this.h()},h(){m(t,"class","text-2xl font-bold mb-6"),m(l,"class","mb-8"),d.disabled=w=o[3]||o[1].some(o[16]),m(d,"class","bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50"),m(a,"class","mt-8 flex justify-end")},m(i,_){P(i,e,_),g(e,t),g(t,n),g(e,u),g(e,l),g(l,s),g(e,f);for(let C=0;C<T.length;C+=1)T[C]&&T[C].m(e,null);P(i,h,_),P(i,a,_),g(a,d),g(d,S),P(i,O,_),re(b,i,_),I=!0,Y||(K=L(d,"click",o[6]),Y=!0)},p(i,[_]){if((!I||_&4)&&r!==(r=i[2].OG_Course_Title+"")&&H(n,r),(!I||_&4)&&c!==(c=i[2].OG_Course_Objective+"")&&H(s,c),_&151){q=ce(i[2].OG_Module_Title);let y;for(y=0;y<q.length;y+=1){const A=we(i,q,y);T[y]?(T[y].p(A,_),z(T[y],1)):(T[y]=Ee(A),T[y].c(),z(T[y],1),T[y].m(e,null))}for(he(),y=q.length;y<T.length;y+=1)Q(y);_e()}(!I||_&8)&&p!==(p=i[3]?"Generating Course...":"Generate Final Course")&&H(S,p),(!I||_&10&&w!==(w=i[3]||i[1].some(i[16])))&&(d.disabled=w);const C={};!E&&_&32&&(E=!0,C.minimized=i[5],ie(()=>E=!1)),b.$set(C)},i(i){if(!I){for(let _=0;_<q.length;_+=1)z(T[_]);z(b.$$.fragment,i),I=!0}},o(i){T=T.filter(Boolean);for(let _=0;_<T.length;_+=1)R(T[_]);R(b.$$.fragment,i),I=!1},d(i){i&&(v(e),v(h),v(a),v(O)),Te(T,i),le(b,i),Y=!1,K()}}}let Xe=null;function Ze(o,e,t){let r,n;ge(o,D,i=>t(20,r=i)),ge(o,Ge,i=>t(21,n=i));let{courseStructure:u}=e,{moduleVideos:l}=e,{selectedVideos:c}=e,{error:s}=e;const f=!1;let h=!1,a=0,d=null,p=[],S=!1;const w=()=>({videoId:"",videoUrl:"",title:"No relevant video found",description:"Please try regenerating the course or selecting a different topic.",length:0,thumbnailUrl:"https://placehold.co/120x90/lightgray/darkgray.png?text=No+Video"});async function O(i,_,C=0){const y=u.OG_Module_Title[_];D.setCurrentModule(_+1,y);const A=3;try{if(!(i!=null&&i.trim()))throw new Error("Search prompt is required");const F=await fetch(`/api/search-videos?query=${encodeURIComponent(i.trim())}&moduleTitle=${encodeURIComponent(y)}&moduleIndex=${_}&retry=${C}`,{headers:{Accept:"application/json","Cross-Origin-Opener-Policy":"same-origin"}});if(!F.ok){const Z=await F.json();throw new Error(Z.error||"Failed to fetch videos")}const N=await F.json();if(!N.videos.some(Z=>Z.videoId!=="")&&C<A)return console.log(`Retrying module ${_+1}, attempt ${C+1}`),await new Promise(Z=>setTimeout(Z,1e3)),O(i,_,C+1);t(0,l[_]=N.videos,l),c[_]===void 0&&t(1,c[_]=0,c),t(0,l=[...l]),t(1,c=[...c])}catch(F){if(console.error(`Error in module ${_+1}:`,F),C<A)return await new Promise(N=>setTimeout(N,1e3)),O(i,_,C+1);t(0,l[_]=Array(3).fill(w()),l),t(0,l=[...l]),t(8,s=`Failed to fetch videos for module ${_+1}: ${F.message}`)}}async function b(){D.setMinimized(!1),D.startLoading(u.OG_Course_Title,!1);try{if(!n)throw new Error("Please sign in to save the course");t(3,h=!0),t(8,s=null);for(let y=0;y<c.length;y++){D.setCurrentModule(y+1),D.setStep(`Building Module ${y+1}: ${u.OG_Module_Title[y]}`);const A=l[y][c[y]],F=await Je(A.videoId);p[y]=F;const N=(y+1)/c.length*80;D.setProgress(N)}D.setStep("Generating course content and quizzes...");const _=await(await fetch("/api/create-final-course",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseStructure:u,selectedVideos:c.map((y,A)=>l[A][y]),moduleTranscripts:p})})).json();if(!_.success)throw new Error(_.error||"Failed to create final course");D.setStep("Saving course..."),D.setProgress(90);const C=await Se(n.uid,_.course);D.stopLoading(C),Pe&&!r.minimized&&window.location.pathname==="/create-course"&&Me(`/course/${C}`)}catch(i){console.error("Save course error:",i);const _=i instanceof Error?i.message:"An unknown error occurred";t(8,s=_),D.setError(_),D.setStep("Error generating course content"),D.setProgress(0)}finally{t(3,h=!1)}}const E=()=>u?a>0&&a<=u.OG_Module_Title.length?`Fetching videos for Module ${a}`:"Preparing your final course...":"Building course structure...";Ie(async()=>{try{for(let i=0;i<u.OG_Module_Title.length;i++)a=i+1,await O(u.OG_Module_YouTube_Search_Prompt[i],i);a=0}catch(i){console.error("Error in onMount:",i),t(8,s="Failed to initialize course videos")}});const I=i=>t(4,d=i.videoId),Y=(i,_)=>{(_.key==="Enter"||_.key===" ")&&t(4,d=i.videoId)},K=(i,_)=>t(1,c[i]=_,c),q=(i,_,C)=>{(C.key==="Enter"||C.key===" ")&&t(1,c[i]=_,c)},T=()=>t(4,d=null),Q=(i,_)=>{t(0,l[_]=[...l[_],i],l),t(0,l=[...l])},X=i=>i===void 0;function W(i){S=i,t(5,S)}return o.$$set=i=>{"courseStructure"in i&&t(2,u=i.courseStructure),"moduleVideos"in i&&t(0,l=i.moduleVideos),"selectedVideos"in i&&t(1,c=i.selectedVideos),"error"in i&&t(8,s=i.error)},[l,c,u,h,d,S,b,E,s,f,I,Y,K,q,T,Q,X,W]}class xe extends ${constructor(e){super(),ee(this,e,Ze,Qe,x,{courseStructure:2,moduleVideos:0,selectedVideos:1,error:8,loading:9})}get loading(){return this.$$.ctx[9]}}function $e(o){let e,t,r,n;function u(s){o[7](s)}function l(s){o[8](s)}let c={courseStructure:o[1],loading:Ce,error:o[2]};return o[3]!==void 0&&(c.moduleVideos=o[3]),o[4]!==void 0&&(c.selectedVideos=o[4]),e=new xe({props:c}),ne.push(()=>ue(e,"moduleVideos",u)),ne.push(()=>ue(e,"selectedVideos",l)),{c(){te(e.$$.fragment)},l(s){oe(e.$$.fragment,s)},m(s,f){re(e,s,f),n=!0},p(s,f){const h={};f&2&&(h.courseStructure=s[1]),f&4&&(h.error=s[2]),!t&&f&8&&(t=!0,h.moduleVideos=s[3],ie(()=>t=!1)),!r&&f&16&&(r=!0,h.selectedVideos=s[4],ie(()=>r=!1)),e.$set(h)},i(s){n||(z(e.$$.fragment,s),n=!0)},o(s){R(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function et(o){let e,t,r;function n(l){o[6](l)}let u={loading:Ce,error:o[2],onSubmit:o[5]};return o[0]!==void 0&&(u.courseObjective=o[0]),e=new ze({props:u}),ne.push(()=>ue(e,"courseObjective",n)),{c(){te(e.$$.fragment)},l(l){oe(e.$$.fragment,l)},m(l,c){re(e,l,c),r=!0},p(l,c){const s={};c&4&&(s.error=l[2]),!t&&c&1&&(t=!0,s.courseObjective=l[0],ie(()=>t=!1)),e.$set(s)},i(l){r||(z(e.$$.fragment,l),r=!0)},o(l){R(e.$$.fragment,l),r=!1},d(l){le(e,l)}}}function tt(o){let e,t,r="Create Your Course",n,u,l,c;const s=[et,$e],f=[];function h(a,d){return a[1]?1:0}return u=h(o),l=f[u]=s[u](o),{c(){e=k("div"),t=k("h1"),t.textContent=r,n=M(),l.c(),this.h()},l(a){e=V(a,"DIV",{class:!0});var d=j(e);t=V(d,"H1",{class:!0,"data-svelte-h":!0}),fe(t)!=="svelte-18htr2l"&&(t.textContent=r),n=G(d),l.l(d),d.forEach(v),this.h()},h(){m(t,"class","text-3xl font-bold mb-8"),m(e,"class","container mx-auto px-4 py-8")},m(a,d){P(a,e,d),g(e,t),g(e,n),f[u].m(e,null),c=!0},p(a,[d]){let p=u;u=h(a),u===p?f[u].p(a,d):(he(),R(f[p],1,1,()=>{f[p]=null}),_e(),l=f[u],l?l.p(a,d):(l=f[u]=s[u](a),l.c()),z(l,1),l.m(e,null))},i(a){c||(z(l),c=!0)},o(a){R(l),c=!1},d(a){a&&v(e),f[u].d()}}}let Ce=!1;function ot(o,e,t){let r="",n=null,u=null,l=[],c=[];async function s(){D.startLoading("",!0),t(2,u=null),t(3,l=[]),t(4,c=[]);try{const p=await(await fetch("/api/generate-course",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({courseInput:r})})).json();if(!p.success)throw new Error(p.error||"Failed to generate course");t(1,n=p.courseStructure),D.setTotalModules(n.OG_Module_Title.length),t(4,c=new Array(n.OG_Module_Title.length).fill(0))}catch(d){console.error("Error building course:",d),t(2,u=d.message),t(1,n=null)}finally{D.stopLoading()}}function f(d){r=d,t(0,r)}function h(d){l=d,t(3,l)}function a(d){c=d,t(4,c)}return[r,n,u,l,c,s,f,h,a]}class dt extends ${constructor(e){super(),ee(this,e,ot,tt,x,{})}}export{dt as component};
